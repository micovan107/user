<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Th√¥ng tin c√° nh√¢n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
    body {
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: #fff;
    }
    .card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      padding: 30px;
      border-radius: 16px;
      width: 100%;
      max-width: 450px;
      text-align: center;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      animation: fadeIn 0.8s ease;
    }
    .card img {
      width: 140px; height: 140px; object-fit: cover; border-radius: 50%;
      border: 4px solid #fff; margin-bottom: 15px; transition: transform 0.3s;
    }
    .card img:hover { transform: scale(1.05); }
    h2 { font-size: 24px; margin-bottom: 10px; }
    p { font-size: 16px; margin: 6px 0; }
    b { color: #ffd86b; }
    .info-section {
      margin-top: 15px; text-align: left;
      background: rgba(255, 255, 255, 0.08);
      padding: 12px; border-radius: 12px;
    }
    .btn {
      display: inline-block;
      margin-top: 15px;
      background: #ffd86b;
      color: #333;
      padding: 10px 18px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    .btn:hover { background: #ffeaa7; }
    .edit-form {
      margin-top: 15px;
      text-align: left;
      display: none;
      background: rgba(255, 255, 255, 0.1);
      padding: 12px;
      border-radius: 12px;
    }
    .edit-form input, .edit-form textarea, .edit-form select {
      width: 100%;
      margin: 6px 0;
      padding: 8px;
      border: none;
      border-radius: 6px;
    }
    .edit-form label { font-weight: 600; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="card" id="personInfo">
    <p>ƒêang t·∫£i th√¥ng tin...</p>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="config.js"></script>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const dbRef = firebase.database().ref('people/' + id);

    dbRef.once('value').then(snapshot => {
      const data = snapshot.val();
      const card = document.getElementById('personInfo');

      if (!data) {
        card.innerHTML = "<p>‚ùå Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi n√†y!</p>";
        return;
      }

      card.innerHTML = `
        <img src="${data.avatar || 'https://placehold.co/200'}" alt="Avatar">
        <h2>${data.name || 'Ng∆∞·ªùi d√πng ·∫©n danh'}</h2>
        <div class="info-section">
          <p><b>üéÇ Ng√†y sinh:</b> ${data.dob || 'Ch∆∞a r√µ'}</p>
          <p><b>üìû SƒêT:</b> ${data.phone || 'Kh√¥ng c√≥'}</p>
          <p><b>üíë T√¨nh tr·∫°ng:</b> ${data.relationship || 'Ch∆∞a r√µ'}</p>
          <p><b>üè´ Tr∆∞·ªùng/N∆°i l√†m vi·ªác:</b> ${data.school || 'Ch∆∞a r√µ'}</p>
          <p><b>üß† NƒÉng l·ª±c:</b> ${data.skills || 'Kh√¥ng c√≥'}</p>
          <p><b>üò® N·ªói s·ª£:</b> ${data.fears || 'Kh√¥ng c√≥'}</p>
          <p><b>üéØ S·ªü th√≠ch:</b> ${data.interests || 'Kh√¥ng c√≥'}</p>
          <p><b>üìú Ti·ªÉu s·ª≠:</b> ${data.bio || 'Ch∆∞a c√≥'}</p>
        </div>
        <a href="index.html" class="btn">‚¨Ö Quay l·∫°i trang ch·ªß</a>
        <button class="btn" onclick="toggleEdit()">‚úçÔ∏è S·ª≠a th√¥ng tin</button>

        <div class="edit-form" id="editForm">
          <label>H·ªç t√™n</label>
          <input id="editName" type="text" value="${data.name || ''}">

          <label>Ng√†y sinh</label>
          <input id="editDob" type="date" value="${data.dob || ''}">

          <label>S·ªë ƒëi·ªán tho·∫°i</label>
          <input id="editPhone" type="text" value="${data.phone || ''}">

          <label>T√¨nh tr·∫°ng</label>
          <select id="editRelationship">
            <option ${data.relationship === 'ƒê·ªôc th√¢n' ? 'selected' : ''}>ƒê·ªôc th√¢n</option>
            <option ${data.relationship === 'C√≥ ng∆∞·ªùi y√™u' ? 'selected' : ''}>C√≥ ng∆∞·ªùi y√™u</option>
            <option ${data.relationship === 'Trong m·ªëi quan h·ªá' ? 'selected' : ''}>Trong m·ªëi quan h·ªá</option>
          </select>

          <label>Tr∆∞·ªùng/N∆°i l√†m vi·ªác</label>
          <input id="editSchool" type="text" value="${data.school || ''}">

          <label>NƒÉng l·ª±c</label>
          <input id="editSkills" type="text" value="${data.skills || ''}">

          <label>N·ªói s·ª£</label>
          <input id="editFears" type="text" value="${data.fears || ''}">

          <label>S·ªü th√≠ch</label>
          <input id="editInterests" type="text" value="${data.interests || ''}">

          <label>Ti·ªÉu s·ª≠</label>
          <textarea id="editBio" rows="3">${data.bio || ''}</textarea>

          <button class="btn" style="margin-top:10px" onclick="saveEdit()">üíæ L∆∞u</button>
        </div>
      `;
    });

    function toggleEdit() {
      const form = document.getElementById('editForm');
      form.style.display = form.style.display === 'block' ? 'none' : 'block';
    }

    function saveEdit() {
      const updatedData = {
        name: document.getElementById('editName').value,
        dob: document.getElementById('editDob').value,
        phone: document.getElementById('editPhone').value,
        relationship: document.getElementById('editRelationship').value,
        school: document.getElementById('editSchool').value,
        skills: document.getElementById('editSkills').value,
        fears: document.getElementById('editFears').value,
        interests: document.getElementById('editInterests').value,
        bio: document.getElementById('editBio').value
      };

      firebase.database().ref('people/' + id).update(updatedData).then(() => {
        alert('‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!');
        location.reload();
      });
    }
  </script>
</body>
</html>
